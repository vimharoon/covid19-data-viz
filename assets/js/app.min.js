var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var width=.95*document.getElementById("container").offsetWidth,height=480,legendCellSize=20,colors="#C8FCEA #80ffdb #72efdd #64dfdf #56cfe1 #48bfe3 #4ea8de #4895ef #4361ee #3f37c9 #3a0ca3 #480ca8 #560bad #7209b7 #b5179e #f72585".split(" "),svg=d3.select("#map").append("svg").attr("id","svg").attr("width",width).attr("height",height).attr("class","svg"),projection=d3.geoNaturalEarth1().scale(1).translate([0,0]),path=d3.geoPath().pointRadius(2).projection(projection);
svg.append("text").attr("x",width/2).attr("y",25).attr("text-anchor","middle").style("fill","#1F0660").style("font-weight","300").style("font-size","20px").text("Nombre de cas COVID-19 d\u00e9tect\u00e9 dans le monde");var cGroup=svg.append("g"),promises=[];promises.push(d3.json("./../../world-countries-no-antartica.json"));promises.push(d3.csv("./../../covid_quot_pays_modif.csv"));
Promise.all(promises).then(function(a){var b=a[0];a=a[1].sort(function(e,m){return new Date(m.date)-new Date(e.date)}).filter(function(e,m,l){return e.date.substring(0,10)===l[0].date.substring(0,10)});var c=path.bounds(b),g=.8/Math.max((c[1][0]-c[0][0])/width,(c[1][1]-c[0][1])/height);c=[(width-g*(c[1][0]+c[0][0]))/2,(height-g*(c[1][1]+c[0][1]))/2];projection.scale(g).translate(c);cGroup.selectAll("path").data(b.features).enter().append("path").attr("d",path).attr("id",function(e){return"code"+e.id}).attr("class",
"country").style("fill","#4B4453").style("stroke","#4B4453").style("stroke-width","0.1");b=d3.min(a,function(e){return+e.infections});g=d3.max(a,function(e){return+e.infections});var d=d3.scaleQuantile().domain([b,g]).range(colors),h=addLegend(b,g),f=addTooltip();a.forEach(function(e,m){var l=d3.select("#code"+e.countryCode);l.attr("scorecolor",d(+e.infections)).style("fill",d(+e.infections)).on("mouseover",function(k){l.style("fill","#F9F871");f.style("display",null);addPieChart(f,[{country:e.frenchCountry,
label:"infections",value:e.infections},{country:e.frenchCountry,label:"recovery",value:e.recovery}]);onCountryChange({country:e.frenchCountry,countryCode:e.countryCode});h.select("#cursor").attr("transform","translate("+(legendCellSize+5)+", "+getColorIndex(d(+e.infections))*legendCellSize+")").style("display",null)}).on("mouseout",function(k){l.style("fill",d(+e.infections));f.style("display","none");h.select("#cursor").style("display","none");rmPieChart()}).on("mousemove",function(k){k=d3.pointer(k);
f.attr("transform","translate("+(k[0]+60)+", "+(k[1]-10)+")")})})});
function addLegend(a,b){var c=svg.append("g").attr("transform","translate(80, 50)");c.selectAll().data(d3.range(colors.length)).enter().append("svg:rect").attr("height",legendCellSize+"px").attr("width",legendCellSize+"px").attr("x",5).attr("y",function(d){return d*legendCellSize}).attr("class","legend-cell").style("fill",function(d){return colors[d]}).on("mouseover",function(d,h){c.select("#cursor").attr("transform","translate("+(legendCellSize+5)+", "+h*legendCellSize+")").style("display",null);
d3.selectAll("path[scorecolor='"+colors[h]+"']").style("fill","#F9F871")}).on("mouseout",function(d,h){c.select("#cursor").style("display","none");d3.selectAll("path[scorecolor='"+colors[h]+"']").style("fill",colors[h])});c.append("svg:rect").attr("y",legendCellSize+colors.length*legendCellSize).attr("height",legendCellSize+"px").attr("width",legendCellSize+"px").attr("x",5).style("fill","#4B4453");c.append("text").attr("x",30).attr("y",35+colors.length*legendCellSize).style("font-size","13px").style("color",
"#4B4453").style("fill","#4B4453").text("Donn\u00e9es non disponible actuellement pour ces pays");c.append("polyline").attr("points",legendCellSize+",0 "+legendCellSize+","+legendCellSize+" "+.2*legendCellSize+","+legendCellSize/2).attr("id","cursor").style("display","none").style("fill","#C34A36");var g=d3.scaleLinear().domain([a,b]).range([0,colors.length*legendCellSize]);legendAxis=c.append("g").attr("class","axis").call(d3.axisLeft(g).ticks(10,"s"));return c}
function addTooltip(){return svg.append("g").attr("id","tooltip").attr("transform","translate(50, 45)").style("display","none")}
function addPieChart(a,b){a.data([b]);var c=d3.scaleOrdinal(["#E74C3C","#7DCEA0"]),g=d3.pie().value(function(d){return d.value});arc=d3.arc().innerRadius(0).outerRadius(45);arcs=a.selectAll("arc").data(g).enter().append("g").attr("class","arc");arcs.append("path").attr("fill",function(d,h){return c(h)}).attr("d",arc);arcs.append("text").attr("transform",function(d){d.innerRadius=0;d.outerRadius=100;return"translate("+arc.centroid(d)+")"}).attr("text-anchor","middle").style("font-size","11px").attr("fill",
"#ffffff").text(function(d,h){return getText(b[h].label)})}function getText(a){return"recovery"===a?"gu\u00e9ri":"contamin\u00e9"}function rmPieChart(){d3.selectAll(".arc").remove()}function shortCountryName(a){return a.replace("D\u00e9mocratique","Dem.").replace("R\u00e9publique","Rep.")}function getColorIndex(a){for(var b=0;b<colors.length;b++)if(colors[b]===a)return b;return-1}addSvgLegend1();
function addSvgLegend1(){d3.select("#svgLegend1").append("svg").attr("width",200).attr("height",400).attr("class","svg").append("circle").attr("cx",40).attr("cy",50).attr("r",3).style("fill","red")}addSvgLegend2();
function addSvgLegend2(){var a=d3.select("#svgLegend2").append("svg").attr("width",200).attr("height",400).attr("class","svg");a.append("circle").attr("cx",40).attr("cy",50).attr("r",3).style("fill","red");a.append("g").attr("transform","translate(40, 50)").selectAll().data(d3.range(colors.length)).enter().append("svg:rect").attr("y",function(b){return b*legendCellSize}).attr("height",legendCellSize+"px").attr("width",legendCellSize+"px").attr("x",5).style("fill",function(b){return colors[b]})}addSvgLegend3();
function addSvgLegend3(){var a=d3.select("#svgLegend3").append("svg").attr("width",200).attr("height",400).attr("class","svg");a.append("circle").attr("cx",40).attr("cy",50).attr("r",3).style("fill","red");a=a.append("g").attr("transform","translate(40, 50)");a.selectAll().data(d3.range(colors.length)).enter().append("svg:rect").attr("y",function(c){return c*legendCellSize}).attr("height",legendCellSize+"px").attr("width",legendCellSize+"px").attr("x",5).style("fill",function(c){return colors[c]});
var b=d3.scaleLinear().domain([44,97]).range([0,colors.length*legendCellSize]);legendAxis=a.append("g").attr("class","axis").call(d3.axisLeft(b))}function onCountryChange(a){var b=a.country;a=a.countryCode;d3.select("#country-evol").text("Evolution de la pand\u00e9mie au "+b);getPandemicEvolution(a)}
var margin={top:15,bottom:30,left:20,right:20},size={w:.95*document.getElementById("container").offsetWidth,h:155},color={handle:"#a6761d",bar:"#e6ab02"},timelineChart=d3.select("#timeline-chart").append("svg").attr("width",size.w+margin.left+margin.right).attr("height",size.h+margin.top+margin.bottom);timelineChart.append("text").attr("id","country-evol").attr("x",size.w/2).attr("y",25).attr("text-anchor","middle").style("fill","#B56AD9").style("font-weight","300").style("font-size","18px").text("Evolution de la pand\u00e9mie au France");
var dataList=[];dataList.push(d3.csv("./../../covid_quot_pays_modif.csv"));
function getPandemicEvolution(a){timelineChart.select("#timeline-chart-data")&&timelineChart.select("#timeline-chart-data").remove();Promise.all(dataList).then(function(b){b=getDataByCountry(b[0],a||"FR");b=groupeDataByDate(b);var c=d3.max(b.map(function(f){return Number(f.value)}));b=b.map(function(f){f.value=Number(percentage(f.value,c));return f}).reverse();var g=d3.scaleBand().domain(b.map(function(f){return f.monthyear})).range([0,size.w]).padding(.2),d=d3.scaleLinear().domain(d3.extent(b,function(f){return f.value})).range([0,
size.h]);d3.axisBottom().scale(g).tickValues(g.domain().filter(function(f,e){return!(e%3)}));d3.brushX().handleSize(8).extent([[0,0],[size.w,size.h]]);var h=timelineChart.append("g").attr("id","timeline-chart-data").attr("transform","translate("+margin.left+", "+margin.top+")");h.append("g").attr("transform","translate(0, "+(size.h+5)+")").call(d3.axisBottom(g)).transition().duration(2E3);h.selectAll("rect").data(b).enter().append("rect").attr("class","bar").attr("x",function(f){return g(f.monthyear)}).attr("y",
function(f){return size.h-d(f.value)}).attr("width",g.bandwidth()).attr("height",function(f){return d(f.value)}).attr("fill",color.bar).attr("opacity",1).transition().duration(2E3).attr("x",function(f){return g(f.monthyear)})})}getPandemicEvolution();function percentage(a,b){return 100*a/b}function getDataByCountry(a,b){return a.filter(function(c){return c.countryCode===b}).map(function(c){return{year:c.date,value:c.infections}})}
function groupeDataByDate(a){a=a.reduce(function(b,c){var g=c.value,d=(new Date(parseDateFormat(c.year))).toLocaleString("fr-FR",{month:"short",year:"numeric"});b[d]?b[d].value=g:b[d]={monthyear:d,value:g};return b},{});return Object.values(a)}function parseDateFormat(a){a=a.split("/");return new Date(parseInt(a[2],10),parseInt(a[1],10)-1,parseInt(a[0],10))}function snappedSelection(a,b){var c=d3.min(b),g=d3.max(b);return[a(c),a(g)+a.bandwidth()]};
